later=function(){var e={version:"0.1.0"};return Array.prototype.indexOf||(Array.prototype.indexOf=function(e){"use strict";if(null==this)throw new TypeError;var t=Object(this),n=t.length>>>0;if(0===n)return-1;var r=0;if(arguments.length>1&&(r=Number(arguments[1]),r!=r?r=0:0!=r&&1/0!=r&&r!=-1/0&&(r=(r>0||-1)*Math.floor(Math.abs(r)))),r>=n)return-1;for(var a=r>=0?r:Math.max(n-Math.abs(r),0);n>a;a++)if(a in t&&t[a]===e)return a;return-1}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),e.array={},e.array.sort=function(e,t){e.sort(function(e,t){return+e-+t}),t&&0===e[0]&&e.push(e.shift())},e.array.next=function(e,t,n){for(var r,a=0!==n[0],i=0,o=t.length-1;o>-1;--o){if(r=t[o],r===e)return r;if(!(r>e||0===r&&a&&n[1]>e))break;i=o}return t[i]},e.array.nextInvalid=function(e,t,n){for(var r=n[0],a=n[1],i=t.length,o=0===t[i-1]&&0!==r?a:0,u=e,d=t.indexOf(e),l=u;u===(t[d]||o);)if(u++,u>a&&(u=r),d++,d===i&&(d=0),u===l)return void 0;return u},e.array.prev=function(e,t,n){for(var r,a=t.length,i=0!==n[0],o=a-1,u=0;a>u;u++){if(r=t[u],r===e)return r;if(!(e>r||0===r&&i&&n[1]<e))break;o=u}return t[o]},e.array.prevInvalid=function(e,t,n){for(var r=n[0],a=n[1],i=t.length,o=0===t[i-1]&&0!==r?a:0,u=e,d=t.indexOf(e);u===(t[d]||o);)u--,r>u&&(u=a),d--,-1===d&&(d=i-1);return u},e.day=e.D={name:"day",range:86400,val:function(t){return t.D||(t.D=e.date.getDate.call(t))},isValid:function(t,n){return e.D.val(t)===(n||e.D.extent(t)[1])},extent:function(t){if(t.DExtent)return t.DExtent;var n=e.M.val(t),r=e.DAYS_IN_MONTH[n-1];return 2===n&&366===e.dy.extent(t)[1]&&(r+=1),t.DExtent=[1,r]},start:function(t){return t.DStart||(t.DStart=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)))},end:function(t){return t.DEnd||(t.DEnd=e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t)))},next:function(t,n){n=n>e.D.extent(t)[1]?1:n;var r=e.date.nextRollover(t,n,e.D,e.M),a=e.D.extent(r)[1];return n=n>a?1:n||a,e.date.next(e.Y.val(r),e.M.val(r),n)},prev:function(t,n){var r=e.date.prevRollover(t,n,e.D,e.M),a=e.D.extent(r)[1];return e.date.prev(e.Y.val(r),e.M.val(r),n>a?a:n||a)}},e.dayOfWeekCount=e.dc={name:"day of week count",range:604800,val:function(t){return t.dc||(t.dc=Math.floor((e.D.val(t)-1)/7)+1)},isValid:function(t,n){return e.dc.val(t)===n||0===n&&e.D.val(t)>e.D.extent(t)[1]-7},extent:function(t){return t.dcExtent||(t.dcExtent=[1,Math.ceil(e.D.extent(t)[1]/7)])},start:function(t){return t.dcStart||(t.dcStart=e.date.next(e.Y.val(t),e.M.val(t),Math.max(1,7*(e.dc.val(t)-1)+1||1)))},end:function(t){return t.dcEnd||(t.dcEnd=e.date.prev(e.Y.val(t),e.M.val(t),Math.min(7*e.dc.val(t),e.D.extent(t)[1])))},next:function(t,n){n=n>e.dc.extent(t)[1]?1:n;var r=e.date.nextRollover(t,n,e.dc,e.M),a=e.dc.extent(r)[1];n=n>a?1:n;var i=e.date.next(e.Y.val(r),e.M.val(r),0===n?e.D.extent(r)[1]-6:1+7*(n-1));return i.getTime()<=t.getTime()?(r=e.M.next(t,e.M.val(t)+1),e.date.next(e.Y.val(r),e.M.val(r),0===n?e.D.extent(r)[1]-6:1+7*(n-1))):i},prev:function(t,n){var r=e.date.prevRollover(t,n,e.dc,e.M),a=e.dc.extent(r)[1];return n=n>a?a:n||a,e.dc.end(e.date.prev(e.Y.val(r),e.M.val(r),1+7*(n-1)))}},e.dayOfWeek=e.dw=e.d={name:"day of week",range:86400,val:function(t){return t.dw||(t.dw=e.date.getDay.call(t)+1)},isValid:function(t,n){return e.dw.val(t)===(n||7)},extent:function(){return[1,7]},start:function(t){return e.D.start(t)},end:function(t){return e.D.end(t)},next:function(t,n){return n=n>7?1:n||7,e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)+(n-e.dw.val(t))+(n<=e.dw.val(t)?7:0))},prev:function(t,n){return n=n>7?7:n||7,e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t)+(n-e.dw.val(t))+(n>=e.dw.val(t)?-7:0))}},e.dayOfYear=e.dy={name:"day of year",range:86400,val:function(t){return t.dy||(t.dy=Math.ceil(1+(e.D.start(t).getTime()-e.Y.start(t).getTime())/e.DAY))},isValid:function(t,n){return e.dy.val(t)===(n||e.dy.extent(t)[1])},extent:function(t){var n=e.Y.val(t);return t.dyExtent||(t.dyExtent=[1,n%4?365:366])},start:function(t){return e.D.start(t)},end:function(t){return e.D.end(t)},next:function(t,n){n=n>e.dy.extent(t)[1]?1:n;var r=e.date.nextRollover(t,n,e.dy,e.Y),a=e.dy.extent(r)[1];return n=n>a?1:n||a,e.date.next(e.Y.val(r),e.M.val(r),n)},prev:function(t,n){var r=e.date.prevRollover(t,n,e.dy,e.Y),a=e.dy.extent(r)[1];return n=n>a?a:n||a,e.date.prev(e.Y.val(r),e.M.val(r),n)}},e.hour=e.h={name:"hour",range:3600,val:function(t){return t.h||(t.h=e.date.getHour.call(t))},isValid:function(t,n){return e.h.val(t)===n},extent:function(){return[0,23]},start:function(t){return t.hStart||(t.hStart=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t)))},end:function(t){return t.hEnd||(t.hEnd=e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t)))},next:function(t,n){n=n>23?0:n;var r=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)+(n<=e.h.val(t)?1:0),n);return!e.date.isUTC&&r.getTime()<=t.getTime()&&(r=e.date.next(e.Y.val(r),e.M.val(r),e.D.val(r),n+1)),r},prev:function(t,n){return n=n>23?23:n,e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t)+(n>=e.h.val(t)?-1:0),n)}},e.minute=e.m={name:"minute",range:60,val:function(t){return t.m||(t.m=e.date.getMin.call(t))},isValid:function(t,n){return e.m.val(t)===n},extent:function(){return[0,59]},start:function(t){return t.mStart||(t.mStart=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t),e.m.val(t)))},end:function(t){return t.mEnd||(t.mEnd=e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t),e.m.val(t)))},next:function(t,n){var r=e.m.val(t),a=e.s.val(t),i=n>59?60-r:r>=n?60-r+n:n-r,o=new Date(t.getTime()+i*e.MIN-a*e.SEC);return!e.date.isUTC&&o.getTime()<=t.getTime()&&(o=new Date(t.getTime()+(i+120)*e.MIN-a*e.SEC)),o},prev:function(t,n){return n=n>59?59:n,e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t)+(n>=e.m.val(t)?-1:0),n)}},e.month=e.M={name:"month",range:2629740,val:function(t){return t.M||(t.M=e.date.getMonth.call(t)+1)},isValid:function(t,n){return e.M.val(t)===(n||12)},extent:function(){return[1,12]},start:function(t){return t.MStart||(t.MStart=e.date.next(e.Y.val(t),e.M.val(t)))},end:function(t){return t.MEnd||(t.MEnd=e.date.prev(e.Y.val(t),e.M.val(t)))},next:function(t,n){return n=n>12?1:n||12,e.date.next(e.Y.val(t)+(n>e.M.val(t)?0:1),n)},prev:function(t,n){return n=n>12?12:n||12,e.date.prev(e.Y.val(t)-(n>=e.M.val(t)?1:0),n)}},e.second=e.s={name:"second",range:1,val:function(t){return t.s||(t.s=e.date.getSec.call(t))},isValid:function(t,n){return e.s.val(t)===n},extent:function(){return[0,59]},start:function(e){return e},end:function(e){return e},next:function(t,n){var r=e.s.val(t),a=n>59?60-r:r>=n?60-r+n:n-r,i=new Date(t.getTime()+a*e.SEC);return!e.date.isUTC&&i.getTime()<=t.getTime()&&(i=new Date(t.getTime()+(a+7200)*e.SEC)),i},prev:function(t,n){return n=n>59?59:n,e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t),e.m.val(t)+(n>=e.s.val(t)?-1:0),n)}},e.time=e.t={name:"time",range:1,val:function(t){return t.t||(t.t=3600*e.h.val(t)+60*e.m.val(t)+e.s.val(t))},isValid:function(t,n){return e.t.val(t)===n},extent:function(){return[0,86399]},start:function(e){return e},end:function(e){return e},next:function(t,n){n=n>86399?0:n;var r=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)+(n<=e.t.val(t)?1:0),0,0,n);return!e.date.isUTC&&r.getTime()<t.getTime()&&(r=e.date.next(e.Y.val(r),e.M.val(r),e.D.val(r),e.h.val(r),e.m.val(r),n+7200)),r},prev:function(t,n){return n=n>86399?86399:n,e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)+(n>=e.t.val(t)?-1:0),0,0,n)}},e.weekOfMonth=e.wm={name:"week of month",range:604800,val:function(t){return t.wm||(t.wm=(e.D.val(t)+(e.dw.val(e.M.start(t))-1)+(7-e.dw.val(t)))/7)},isValid:function(t,n){return e.wm.val(t)===(n||e.wm.extent(t)[1])},extent:function(t){return t.wmExtent||(t.wmExtent=[1,(e.D.extent(t)[1]+(e.dw.val(e.M.start(t))-1)+(7-e.dw.val(e.M.end(t))))/7])},start:function(t){return t.wmStart||(t.wmStart=e.date.next(e.Y.val(t),e.M.val(t),Math.max(e.D.val(t)-e.dw.val(t)+1,1)))},end:function(t){return t.wmEnd||(t.wmEnd=e.date.prev(e.Y.val(t),e.M.val(t),Math.min(e.D.val(t)+(7-e.dw.val(t)),e.D.extent(t)[1])))},next:function(t,n){n=n>e.wm.extent(t)[1]?1:n;var r=e.date.nextRollover(t,n,e.wm,e.M),a=e.wm.extent(r)[1];return n=n>a?1:n||a,e.date.next(e.Y.val(r),e.M.val(r),Math.max(1,7*(n-1)-(e.dw.val(r)-2)))},prev:function(t,n){var r=e.date.prevRollover(t,n,e.wm,e.M),a=e.wm.extent(r)[1];return n=n>a?a:n||a,e.wm.end(e.date.next(e.Y.val(r),e.M.val(r),Math.max(1,7*(n-1)-(e.dw.val(r)-2))))}},e.weekOfYear=e.wy={name:"week of year (ISO)",range:604800,val:function(t){if(t.wy)return t.wy;var n=e.dw.next(e.wy.start(t),5),r=e.dw.next(e.Y.prev(n,e.Y.val(n)-1),5);return t.wy=1+Math.ceil((n.getTime()-r.getTime())/e.WEEK)},isValid:function(t,n){return e.wy.val(t)===(n||e.wy.extent(t)[1])},extent:function(t){if(t.wyExtent)return t.wyExtent;var n=e.dw.next(e.wy.start(t),5),r=e.dw.val(e.Y.start(n)),a=e.dw.val(e.Y.end(n));return t.wyExtent=[1,5===r||5===a?53:52]},start:function(t){return t.wyStart||(t.wyStart=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)-(e.dw.val(t)>1?e.dw.val(t)-2:6)))},end:function(t){return t.wyEnd||(t.wyEnd=e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t)+(e.dw.val(t)>1?8-e.dw.val(t):0)))},next:function(t,n){n=n>e.wy.extent(t)[1]?1:n;var r=e.dw.next(e.wy.start(t),5),a=e.date.nextRollover(r,n,e.wy,e.Y);1!==e.wy.val(a)&&(a=e.dw.next(a,2));var i=e.wy.extent(a)[1],o=e.wy.start(a);return n=n>i?1:n||i,e.date.next(e.Y.val(o),e.M.val(o),e.D.val(o)+7*(n-1))},prev:function(t,n){var r=e.dw.next(e.wy.start(t),5),a=e.date.prevRollover(r,n,e.wy,e.Y);1!==e.wy.val(a)&&(a=e.dw.next(a,2));var i=e.wy.extent(a)[1],o=e.wy.end(a);return n=n>i?i:n||i,e.wy.end(e.date.next(e.Y.val(o),e.M.val(o),e.D.val(o)+7*(n-1)))}},e.year=e.Y={name:"year",range:31556900,val:function(t){return t.Y||(t.Y=e.date.getYear.call(t))},isValid:function(t,n){return e.Y.val(t)===n},extent:function(){return[1970,2099]},start:function(t){return t.YStart||(t.YStart=e.date.next(e.Y.val(t)))},end:function(t){return t.YEnd||(t.YEnd=e.date.prev(e.Y.val(t)))},next:function(t,n){return n>e.Y.val(t)&&n<=e.Y.extent()[1]?e.date.next(n):void 0},prev:function(t,n){return n<e.Y.val(t)&&n>=e.Y.extent()[0]?e.date.prev(n):void 0}},e.modifier={},e.modifier.after=e.modifier.a=function(e,t){var n=t[0];return{name:"after "+e.name,range:(e.extent(new Date)[1]-n)*e.range,val:function(t){var r=e.val(t);return r>=n?n:r},isValid:function(e,t){return this.val(e)===t},extent:e.extent,start:e.start,end:e.end,next:function(t,r){return r>n&&(r=e.extent(t)[0]),e.next(t,r)},prev:function(t,r){return r>=n&&(r=e.extent(t)[1]),e.prev(t,r)}}},e.modifier.before=e.modifier.b=function(e,t){var n=t[t.length-1];return{name:"before "+e.name,range:e.range*n,val:function(t){var r=e.val(t);return n>=r?n:r},isValid:function(e,t){return this.val(e)===t},extent:e.extent,start:e.start,end:e.end,next:function(t,r){return n>=r&&(r=e.extent(t)[0]),e.next(t,r)},prev:function(t,r){return n>r&&(r=e.extent(t)[1]),e.prev(t,r)}}},e.compile=function(t){var n,r=[],a=0;for(var i in t){var o=i.split("_"),u=o[0],d=o[1],l=t[i],v=d?e.modifier[d](e[u],l):e[u];r.push({constraint:v,vals:l}),a++}return r.sort(function(e,t){return e.constraint.range<t.constraint.range}),n=r[a-1].constraint,{start:function(t,i){var o,u=i,d=e.array[t];for(console.log("start ---------------------");!o&&u;){o=!0;for(var l=0;a>l;l++){var v=r[l].constraint,f=v.val(u),c=v.extent(u),s=d(f,r[l].vals,c);if(console.log("constraint = "+v.name),console.log("next = "+u.toUTCString()),console.log("curVal = "+f),console.log("extent = "+c),console.log("newVal = "+s),console.log("is valid = "+v.isValid(u,s)),!v.isValid(u,s)){u=v[t](u,s),o=!1;break}}}return console.log("return = "+(u?n.start(u):void 0)),u?n.start(u):void 0},end:function(t){for(var n,i=a-1;i>=0;i--){var o,u=r[i].constraint,d=u.val(t),l=u.extent(t),v=e.array.nextInvalid(d,r[i].vals,l);if(u.isValid(t,v))return t;void 0!==v&&(o=u.next(t,v),(!n||n>o)&&(n=o))}return n},tick:function(t,r){return console.log("TICK"),console.log("date="+r),console.log("next="+new Date(n.end(r).getTime()+e.SEC)),new Date("next"===t?n.end(r).getTime()+e.SEC:n.start(r).getTime()-e.SEC)}}},e.schedule=function(t){function n(e,t,n,f,m){var h,x,w=d(e),y=t,g=[],p=[],M=[];if(n=n?new Date(n):new Date,!n||!n.getTime())throw new Error("Invalid start date.");for(r(e,v,g,n);y&&(h=l(g,w));)if(w(n,h))i(e,v,g,h);else{if(f&&w(h,f))break;s&&(a(e,c,p,h),x=o(e,c,p,h))?r(e,v,g,x):(m?(x=u(e,v,g,h,l(p,w)),M.push([new Date(h),new Date(x)]),x="next"===e?x:new Date(h.getTime()-1e3),r(e,v,g,x)):(M.push(new Date(h)),i(e,v,g,h)),y--)}return 0===M.length?void 0:1===t?M[0]:M}function r(e,t,n,r){for(var a=d(e),i=0,o=t.length;o>i;i++)n[i]&&a(n[i],r)||(n[i]=t[i].start(e,r))}function a(e,t,n,r){for(var a=d(e),i=0,o=t.length;o>i;i++)if(!n[i]||!a(n[i][0],r)){var u=t[i].start(e,r);n[i]=u?[u,t[i].end(u)]:void 0}}function i(e,t,n,r){for(var a=0,i=t.length;i>a;a++)n[a]&&n[a].getTime()===r.getTime()&&(n[a]=t[a].start(e,t[a].tick(e,r)))}function o(e,t,n,r){for(var a,i=d(e),o=0,u=t.length;u>o;o++){var l=n[o];if(l&&r.getTime()>=l[0].getTime()&&(!l[1]||r.getTime()<l[1].getTime())){var v="next"===e?l[1]:new Date(l[0].getTime()-1e3);(!a||i(v,a))&&(a=v)}}return a}function u(e,t,n,r,a){for(var i,o=d(e),u=0,l=t.length;l>u;u++){var v=n[u];if(v&&v.getTime()===r.getTime()){var f=t[u].end(v);if(a&&o(f,a))return a;(!i||o(f,i))&&(i=f)}}return i}function d(e){return"next"===e?function(e,t){return e.getTime()>t.getTime()}:function(e,t){return t.getTime()>e.getTime()}}function l(e,t){for(var n=e[0],r=1,a=e.length;a>r;r++)e[r]&&t(n,e[r])&&(n=e[r]);return n}if(!t)throw new Error("Missing schedule definition.");if(!t.schedules)throw new Error("Definition must include at least one schedule.");for(var v=[],f=t.schedules.length,c=[],s=t.exceptions?t.exceptions.length:0,m=0;f>m;m++)v.push(e.compile(t.schedules[m]));for(var h=0;s>h;h++)c.push(e.compile(t.exceptions[h]));return{isValid:function(e){return void 0!==n("next",1,e,e)},next:function(e,t,r){return n("next",e||1,t,r)},prev:function(e,t,r){return n("prev",e||1,t,r)},nextRange:function(e,t,r){return n("next",e||1,t,r,!0)},prevRange:function(e,t,r){return n("prev",e||1,t,r,!0)}}},e.setTimeout=function(t,n){function r(){var e=Date.now(),n=i.next(2,e),o=n[0].getTime()-e;1e3>o&&(o=n[1].getTime()-e),a=2147483647>o?setTimeout(t,o):setTimeout(r,2147483647)}var a,i=e.schedule(n);return r(),{clear:function(){clearTimeout(a)}}},e.setInterval=function(t,n){function r(){i||(t(),a=e.setTimeout(r,n))}var a=e.setTimeout(r,n),i=!1;return{clear:function(){i=!0,a.clear()}}},e.date={},e.date.timezone=function(t){e.date.build=t?function(e,t,n,r,a,i){return new Date(e,t,n,r,a,i)}:function(e,t,n,r,a,i){return new Date(Date.UTC(e,t,n,r,a,i))};var n=t?"get":"getUTC",r=Date.prototype;e.date.getYear=r[n+"FullYear"],e.date.getMonth=r[n+"Month"],e.date.getDate=r[n+"Date"],e.date.getDay=r[n+"Day"],e.date.getHour=r[n+"Hours"],e.date.getMin=r[n+"Minutes"],e.date.getSec=r[n+"Seconds"],e.date.isUTC=!t},e.date.UTC=function(){e.date.timezone(!1)},e.date.localTime=function(){e.date.timezone(!0)},e.date.UTC(),e.SEC=1e3,e.MIN=60*e.SEC,e.HOUR=60*e.MIN,e.DAY=24*e.HOUR,e.WEEK=7*e.DAY,e.DAYS_IN_MONTH=[31,28,31,30,31,30,31,31,30,31,30,31],e.date.next=function(t,n,r,a,i,o){return e.date.build(t,void 0!==n?n-1:0,void 0!==r?r:1,a||0,i||0,o||0)},e.date.nextRollover=function(t,n,r,a){var i=r.val(t),o=r.extent(t)[1];return i>=(n||o)||n>o?new Date(a.end(t).getTime()+e.SEC):a.start(t)},e.date.prev=function(t,n,r,a,i,o){var u=arguments.length;return n=2>u?11:n-1,r=3>u?e.D.extent(e.date.next(t,n+1))[1]:r,a=4>u?23:a,i=5>u?59:i,o=6>u?59:o,e.date.build(t,n,r,a,i,o)},e.date.prevRollover=function(e,t,n,r){var a=n.val(e);return t>=a||!t?r.start(r.prev(e,r.val(e)-1)):r.start(e)},e.parse={},e.parse.cron=function(e,t){function n(e,t){return isNaN(e)?c[e]||null:+e+(t||0)}function r(e){var t,n={};for(t in e)"dc"!==t&&"d"!==t&&(n[t]=e[t].slice(0));return n}function a(e,t,n,r,a){var i=n;for(e[t]||(e[t]=[]);r>=i;)e[t].indexOf(i)<0&&e[t].push(i),i+=a||1}function i(e,t,n,i){(t.d&&!t.dc||t.dc&&t.dc.indexOf(i)<0)&&(e.push(r(t)),t=e[e.length-1]),a(t,"d",n,n),a(t,"dc",i,i)}function o(e,t,n){var r={},i={};1===n?(a(t,"D",1,3),a(t,"d",c.MON,c.FRI),a(r,"D",2,2),a(r,"d",c.TUE,c.FRI),a(i,"D",3,3),a(i,"d",c.TUE,c.FRI)):(a(t,"D",n-1,n+1),a(t,"d",c.MON,c.FRI),a(r,"D",n-1,n-1),a(r,"d",c.MON,c.THU),a(i,"D",n+1,n+1),a(i,"d",c.TUE,c.FRI)),e.exceptions.push(r),e.exceptions.push(i)}function u(e,t,r,i,o,u){var d=e.split("/"),l=+d[1],v=d[0];if("*"!==v&&"0"!==v){var f=v.split("-");i=n(f[0],u),o=n(f[1],u)||o}a(t,r,i,o,l)}function d(e,t,r,d,l,v){var f,c,s=t.schedules,m=s[s.length-1];"L"===e&&(e=d-1),null!==(f=n(e,v))?a(m,r,f,f):null!==(f=n(e.replace("W",""),v))?o(t,m,f):null!==(f=n(e.replace("L",""),v))?i(s,m,f,d-1):2===(c=e.split("#")).length?(f=n(c[0],v),i(s,m,f,n(c[1]))):u(e,m,r,d,l,v)}function l(e){return e.indexOf("#")>-1||e.indexOf("L")>0}function v(e,t){return l(e)&&!l(t)?1:0}function f(e){var t,n,r,a,i={schedules:[{}],exceptions:[]},o=e.split(" ");for(t in s)if(n=s[t],r=o[n[0]],r&&"*"!==r&&"?"!==r){a=r.split(",").sort(v);var u,l=a.length;for(u=0;l>u;u++)d(a[u],i,t,n[1],n[2],n[3])}return i}var c={JAN:1,FEB:2,MAR:3,APR:4,MAY:5,JUN:6,JUL:7,AUG:8,SEP:9,OCT:10,NOV:11,DEC:12,SUN:1,MON:2,TUE:3,WED:4,THU:5,FRI:6,SAT:7},s={s:[0,0,59],m:[1,0,59],h:[2,0,23],D:[3,1,31],M:[4,1,12],Y:[6,1970,2099],d:[5,1,7,1]},m=e.toUpperCase();return f(t?m:"0 "+m)},e.parse.recur=function(){function t(e,t,f){if(e=o?e+"_"+o:e,n||(s.push({}),n=s[0]),n[e]||(n[e]=[]),r=n[e],i){for(a=[],l=t;f>=l;l+=i)a.push(l);v={n:e,x:i,c:r.length,m:f}}a=u?[t]:d?[f]:a;var c=a.length;for(l=0;c>l;l+=1)val=a[l],r.indexOf(val)<0&&r.push(val);a=i=o=u=d=0}var n,r,a,i,o,u,d,l,v,f=[],c=[],s=f;return{schedules:f,exceptions:c,on:function(){return a=arguments[0]instanceof Array?arguments[0]:arguments,this},every:function(e){return i=e||1,this},after:function(e){return o="a",a=[e],this},before:function(e){return o="b",a=[e-1],this},first:function(){return u=1,this},last:function(){return d=1,this},time:function(){for(var e=0,n=a.length;n>e;e++){var r=a[e].split(":");r.length<3&&r.push(0),a[e]=3600*+r[0]+60*+r[1]+ +r[2]}return t("t"),this},second:function(){return t("s",0,59),this},minute:function(){return t("m",0,59),this},hour:function(){return t("h",0,23),this},dayOfMonth:function(){return t("D",1,d?0:31),this},dayOfWeek:function(){return t("d",1,7),this},onWeekend:function(){return a=[1,7],this.dayOfWeek()},onWeekday:function(){return a=[2,3,4,5,6],this.dayOfWeek()},dayOfWeekCount:function(){return t("dc",1,d?0:5),this},dayOfYear:function(){return t("dy",1,d?0:366),this},weekOfMonth:function(){return t("wm",1,d?0:5),this},weekOfYear:function(){return t("wy",1,d?0:53),this},month:function(){return t("M",1,12),this},year:function(){return t("Y",1970,2450),this},customModifier:function(t){var n=e.modifier[t];if(!n)throw new Error("Custom modifier "+t+" not recognized!");return o=t,a=arguments[1]instanceof Array?arguments[1]:[arguments[1]],this},customPeriod:function(n){var r=e[n];if(!r)throw new Error("Custom time period "+n+" not recognized!");return t(n,r.extent(new Date)[0],r.extent(new Date)[1]),this},startingOn:function(e){return this.between(e,v.m)},between:function(e,r){return n[v.n]=n[v.n].splice(0,v.c),i=v.x,t(v.n,e,r),this},and:function(){return n=s[s.push({})-1],this},except:function(){return s=c,n=null,this}}},e.parse.text=function(t){function n(e,t,n,r){return{startPos:e,endPos:t,text:n,type:r}}function r(e){var t,r,a,i,o,u,d=e instanceof Array?e:[e],l=/\s+/;for(d.push(l),o=w;!t||t.type===l;){u=-1,r=y.substring(o),t=n(o,o,y.split(l)[0]);var v,f=d.length;for(v=0;f>v;v++)i=d[v],a=i.exec(r),a&&0===a.index&&a[0].length>u&&(u=a[0].length,t=n(o,o+u,r.substring(0,u),i));t.type===l&&(o=t.endPos)}return t}function a(e){var t=r(e);return w=t.endPos,t}function i(e){for(var t=+s(e),n=f(g.through)?+s(e):t,r=[],a=t;n>=a;a++)r.push(a);return r}function o(e){for(var t=i(e);f(g.and);)t=t.concat(i(e));return t}function u(e){var t,n,r,a;f(g.weekend)?e.on(p.sun,p.sat).dayOfWeek():f(g.weekday)?e.on(p.mon,p.tue,p.wed,p.thu,p.fri).dayOfWeek():(t=s(g.rank),e.every(t),n=v(e),f(g.start)?(t=s(g.rank),e.startingOn(t),c(n.type)):f(g.between)&&(r=s(g.rank),f(g.and)&&(a=s(g.rank),e.between(r,a))))}function d(e){f(g.first)?e.first():f(g.last)?e.last():e.on(o(g.rank)),v(e)}function l(e){w=0,y=e,h=-1;for(var t=x();w<y.length&&0>h;){var n=c([g.every,g.after,g.before,g.onthe,g.on,g.of,g["in"],g.at,g.and,g.except,g.also]);switch(n.type){case g.every:u(t);break;case g.after:void 0!==r(g.time).type?(t.after(s(g.time)),t.time()):(t.after(s(g.rank)),v(t));break;case g.before:void 0!==r(g.time).type?(t.before(s(g.time)),t.time()):(t.before(s(g.rank)),v(t));break;case g.onthe:d(t);break;case g.on:t.on(o(g.dayName)).dayOfWeek();break;case g.of:t.on(o(g.monthName)).month();break;case g["in"]:t.on(o(g.yearIndex)).year();break;case g.at:for(t.on(s(g.time)).time();f(g.and);)t.on(s(g.time)).time();break;case g.and:break;case g.also:t.and();break;case g.except:t.except();break;default:h=w}}return{schedules:t.schedules,exceptions:t.exceptions,error:h}}function v(e){var t=c([g.second,g.minute,g.hour,g.dayOfYear,g.dayOfWeek,g.dayInstance,g.day,g.month,g.year,g.weekOfMonth,g.weekOfYear]);switch(t.type){case g.second:e.second();break;case g.minute:e.minute();break;case g.hour:e.hour();break;case g.dayOfYear:e.dayOfYear();break;case g.dayOfWeek:e.dayOfWeek();break;case g.dayInstance:e.dayOfWeekCount();break;case g.day:e.dayOfMonth();break;case g.weekOfMonth:e.weekOfMonth();break;case g.weekOfYear:e.weekOfYear();break;case g.month:e.month();break;case g.year:e.year();break;default:h=w}return t}function f(e){var t=r(e).type===e;return t&&a(e),t}function c(e){var t=a(e);return t.type?t.text=m(t.text,e):h=w,t}function s(e){return c(e).text}function m(e,t){var n=e;switch(t){case g.time:var r=e.split(/(:|am|pm)/),a="pm"===r[3]&&r[0]<12?parseInt(r[0],10)+12:r[0],i=r[2].trim();n=(1===a.length?"0":"")+a+":"+i;break;case g.rank:n=parseInt(/^\d+/.exec(e)[0],10);break;case g.monthName:case g.dayName:n=p[e.substring(0,3)]}return n}var h,x=e.parse.recur,w=0,y="",g={eof:/^$/,rank:/^((\d\d\d\d)|([2-5]?1(st)?|[2-5]?2(nd)?|[2-5]?3(rd)?|(0|[1-5]?[4-9]|[1-5]0|1[1-3])(th)?))\b/,time:/^((([0]?[1-9]|1[0-2]):[0-5]\d(\s)?(am|pm))|(([0]?\d|1\d|2[0-3]):[0-5]\d))\b/,dayName:/^((sun|mon|tue(s)?|wed(nes)?|thu(r(s)?)?|fri|sat(ur)?)(day)?)\b/,monthName:/^(jan(uary)?|feb(ruary)?|ma((r(ch)?)?|y)|apr(il)?|ju(ly|ne)|aug(ust)?|oct(ober)?|(sept|nov|dec)(ember)?)\b/,yearIndex:/^(\d\d\d\d)\b/,every:/^every\b/,after:/^after\b/,before:/^before\b/,second:/^(s|sec(ond)?(s)?)\b/,minute:/^(m|min(ute)?(s)?)\b/,hour:/^(h|hour(s)?)\b/,day:/^(day(s)?( of the month)?)\b/,dayInstance:/^day instance\b/,dayOfWeek:/^day(s)? of the week\b/,dayOfYear:/^day(s)? of the year\b/,weekOfYear:/^week(s)?( of the year)?\b/,weekOfMonth:/^week(s)? of the month\b/,weekday:/^weekday\b/,weekend:/^weekend\b/,month:/^month(s)?\b/,year:/^year(s)?\b/,between:/^between (the)?\b/,start:/^(start(ing)? (at|on( the)?)?)\b/,at:/^(at|@)\b/,and:/^(,|and\b)/,except:/^(except\b)/,also:/(also)\b/,first:/^(first)\b/,last:/^last\b/,"in":/^in\b/,of:/^of\b/,onthe:/^on the\b/,on:/^on\b/,through:/(-|^(to|through)\b)/},p={jan:1,feb:2,mar:3,apr:4,may:5,jun:6,jul:7,aug:8,sep:9,oct:10,nov:11,dec:12,sun:1,mon:2,tue:3,wed:4,thu:5,fri:6,sat:7,"1st":1,fir:1,"2nd":2,sec:2,"3rd":3,thi:3,"4th":4,"for":4};return l(t.toLowerCase())},e}();