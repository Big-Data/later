later=function(){var e={version:"0.1.0"};return Array.prototype.indexOf||(Array.prototype.indexOf=function(e){"use strict";if(null==this)throw new TypeError;var t=Object(this),n=t.length>>>0;if(0===n)return-1;var r=0;if(arguments.length>1&&(r=Number(arguments[1]),r!=r?r=0:0!=r&&1/0!=r&&r!=-1/0&&(r=(r>0||-1)*Math.floor(Math.abs(r)))),r>=n)return-1;for(var a=r>=0?r:Math.max(n-Math.abs(r),0);n>a;a++)if(a in t&&t[a]===e)return a;return-1}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),e.array={},e.array.sort=function(e,t){e.sort(function(e,t){return+e-+t}),t&&0===e[0]&&e.push(e.shift())},e.array.next=function(e,t,n){for(var r,a=0===n[0]?0:n[1],o=t[0]||a,u=t.length-1;u>-1;--u){r=t[u]||a;{if(!(r>e)){if(r===e)return r;break}o=r}}return n[1]>=o?o:n[0]},e.array.nextInvalid=function(e,t,n){for(var r=n[0],a=n[1],o=t.length,u=0===t[o-1]&&0!==r?a:0,i=e,v=t.indexOf(e),d=i;i===(t[v]||u);)if(i++,i>a&&(i=r),v++,v===o&&(v=0),i===d)return void 0;return i},e.array.prev=function(e,t,n){for(var r,a=t.length,o=t[a-1]||n,u=0;a>u;u++){r=t[u]||n;{if(!(e>r)){if(r===e)return r;break}o=r}}return o},e.array.prevInvalid=function(e,t,n){for(var r=n[0],a=n[1],o=t.length,u=0===t[o-1]&&0!==r?a:0,i=e,v=t.indexOf(e);i===(t[v]||u);)i--,r>i&&(i=a),v--,-1===v&&(v=o-1);return i},e.array.minIndex=function(e){for(var t=e[0],n=0,r=1;e.length>r;r++)t>e[r]&&(t=e[r],n=r);return n},e.array.maxIndex=function(e){for(var t=e[0],n=0,r=1;e.length>r;r++)e[r]>t&&(t=e[r],n=r);return n},e.day=e.D={name:"day",val:function(t){return t.D||(t.D=e.date.getDate.call(t))},extent:function(t){return t.DExtent||(t.DExtent=[1,e.D.val(new Date(e.Y.val(t),e.M.val(t),0))])},start:function(t){return t.DStart||(t.DStart=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)))},end:function(t){return t.DEnd||(t.DEnd=e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t)))},next:function(t,n){var r=e.date.nextRollover(t,n,e.D,e.M),a=e.D.extent(r)[1];return n=n>a?1:n,e.date.next(e.Y.val(r),e.M.val(r),n)},prev:function(t,n){var r=e.date.prevRollover(t,n,e.D,e.M),a=e.D.extent(r)[1];return n=n>a?a:n,e.date.prev(e.Y.val(r),e.M.val(r),n)}},e.dayOfWeekCount=e.dc={name:"day of week count",val:function(t){return t.dc||(t.dc=Math.floor((e.D.val(t)-1)/7)+1)},extent:function(t){return t.dcExtent||(t.dcExtent=[1,Math.ceil(e.D.extent(t)[1]/7)])},start:function(t){return t.dcStart||(t.dcStart=e.date.next(e.Y.val(t),e.M.val(t),Math.max(1,7*(e.dc.val(t)-1)+1||1)))},end:function(t){return t.dcEnd||(t.dcEnd=e.date.prev(e.Y.val(t),e.M.val(t),Math.min(7*e.dc.val(t),e.D.extent(t)[1])))},next:function(t,n){var r=e.date.nextRollover(t,n,e.dc,e.M),a=e.dc.extent(r)[1];return n=n>a?1:n,e.date.next(e.Y.val(r),e.M.val(r),1+7*(n-1))},prev:function(t,n){var r=e.date.prevRollover(t,n,e.dc,e.M),a=e.dc.extent(r)[1];return n=n>a?a:n,e.dc.end(e.date.prev(e.Y.val(r),e.M.val(r),1+7*(n-1)))}},e.dayOfWeek=e.dw={name:"day of week",val:function(t){return t.dw||(t.dw=e.date.getDay.call(t)+1)},extent:function(){return[1,7]},start:function(t){return e.D.start(t)},end:function(t){return e.D.end(t)},next:function(t,n){return e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)+(n-e.dw.val(t))+(e.dw.val(t)>=n?7:0))},prev:function(t,n){return e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t)+(n-e.dw.val(t))+(n>=e.dw.val(t)?-7:0))}},e.dayOfYear=e.dy={name:"day of year",val:function(t){return t.dy||(t.dy=Math.ceil(1+(e.D.start(t).getTime()-e.Y.start(t).getTime())/e.DAY))},extent:function(t){var n=e.Y.val(t);return t.dyExtent||(t.dyExtent=[1,0!==n%4||0===n%100&&0!==n%400?365:366])},start:function(t){return e.D.start(t)},end:function(t){return e.D.end(t)},next:function(t,n){var r=e.date.nextRollover(t,n,e.dy,e.Y),a=e.dy.extent(r)[1];return n=n>a?1:n,e.date.next(e.Y.val(r),e.M.val(r),n)},prev:function(t,n){var r=e.date.prevRollover(t,n,e.dy,e.Y),a=e.dy.extent(r)[1];return n=n>a?a:n,e.date.prev(e.Y.val(r),e.M.val(r),n)}},e.hour=e.h={name:"hour",val:function(t){return t.h||(t.h=e.date.getHour.call(t))},extent:function(){return[0,23]},start:function(t){return t.hStart||(t.hStart=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t)))},end:function(t){return t.hEnd||(t.hEnd=e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t)))},next:function(t,n){var r=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)+(e.h.val(t)>=n?1:0),n);return!e.option.UTC&&r.getTime()<=t.getTime()&&(r=e.date.next(e.Y.val(r),e.M.val(r),e.D.val(r),n+1)),r},prev:function(t,n){return e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t)+(n>=e.h.val(t)?-1:0),n)}},e.minute=e.m={name:"minute",val:function(t){return t.m||(t.m=e.date.getMin.call(t))},extent:function(){return[0,59]},start:function(t){return t.mStart||(t.mStart=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t),e.m.val(t)))},end:function(t){return t.mEnd||(t.mEnd=e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t),e.m.val(t)))},next:function(t,n){var r=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t)+(e.m.val(t)>=n?1:0),n);return!e.option.UTC&&r.getTime()<=t.getTime()&&(r=e.date.next(e.Y.val(r),e.M.val(r),e.D.val(r),e.h.val(r),n+120)),r},prev:function(t,n){return e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t)+(n>=e.m.val(t)?-1:0),n)}},e.month=e.M={name:"month",val:function(t){return t.M||(t.M=e.date.getMonth.call(t)+1)},extent:function(){return[1,12]},start:function(t){return t.MStart||(t.MStart=e.date.next(e.Y.val(t),e.M.val(t)))},end:function(t){return t.MEnd||(t.MEnd=e.date.prev(e.Y.val(t),e.M.val(t)))},next:function(t,n){return e.date.next(e.Y.val(t)+(e.M.val(t)>=n?1:0),n)},prev:function(t,n){return e.date.prev(e.Y.val(t)-(n>=e.M.val(t)?1:0),n)}},e.second=e.s={name:"second",val:function(t){return t.s||(t.s=e.date.getSec.call(t))},extent:function(){return[0,59]},start:function(e){return e},end:function(e){return e},next:function(t,n){var r=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t),e.m.val(t)+(e.s.val(t)>=n?1:0),n);return!e.option.UTC&&r.getTime()<=t.getTime()&&(r=e.date.next(e.Y.val(r),e.M.val(r),e.D.val(r),e.h.val(r),e.m.val(r),n+7200)),r},prev:function(t,n){return e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t),e.m.val(t)+(n>=e.s.val(t)?-1:0),n)}},e.time=e.t={name:"time",val:function(t){return t.t||(t.t=3600*e.h.val(t)+60*e.m.val(t)+e.s.val(t))},extent:function(){return[0,86399]},start:function(e){return e},end:function(e){return e},next:function(t,n){var r=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)+(e.t.val(t)>=n?1:0),0,0,n);return!e.option.UTC&&r.getTime()<t.getTime()&&(r=e.date.next(e.Y.val(r),e.M.val(r),e.D.val(r),e.h.val(r),e.m.val(r),n+7200)),r},prev:function(t,n){return e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)+(n>=e.t.val(t)?-1:0),0,0,n)}},e.weekOfMonth=e.wm={name:"week of month",val:function(t){return t.wm||(t.wm=(e.D.val(t)+(e.dw.val(e.M.start(t))-1)+(7-e.dw.val(t)))/7)},extent:function(t){return t.wmExtent||(t.wmExtent=[1,(e.D.extent(t)[1]+(e.dw.val(e.M.start(t))-1)+(7-e.dw.val(e.M.end(t))))/7])},start:function(t){return t.wmStart||(t.wmStart=e.date.next(e.Y.val(t),e.M.val(t),Math.max(e.D.val(t)-e.dw.val(t)+1,1)))},end:function(t){return t.wmEnd||(t.wmEnd=e.date.prev(e.Y.val(t),e.M.val(t),Math.min(e.D.val(t)+(7-e.dw.val(t)),e.D.extent(t)[1])))},next:function(t,n){var r=e.date.nextRollover(t,n,e.wm,e.M),a=e.wm.extent(r)[1];return n=n>a?1:n,e.date.next(e.Y.val(r),e.M.val(r),Math.max(1,7*(n-1)-(e.dw.val(r)-2)))},prev:function(t,n){var r=e.date.prevRollover(t,n,e.wm,e.M),a=e.wm.extent(r)[1];return n=n>a?a:n,e.wm.end(e.date.next(e.Y.val(r),e.M.val(r),Math.max(1,7*(n-1)-(e.dw.val(r)-2))))}},e.weekOfYear=e.wy={name:"week of year (ISO)",val:function(t){if(t.wy)return t.wy;var n=e.dw.next(e.wy.start(t),5),r=e.dw.next(e.Y.prev(n,e.Y.val(n)-1),5);return t.wy=1+Math.ceil((n.getTime()-r.getTime())/e.WEEK)},extent:function(t){if(t.wyExtent)return t.wyExtent;var n=e.dw.next(e.wy.start(t),5),r=e.dw.val(e.Y.start(n)),a=e.dw.val(e.Y.end(n));return t.wyExtent=[1,5===r||5===a?53:52]},start:function(t){return t.wyStart||(t.wyStart=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)-(e.dw.val(t)>1?e.dw.val(t)-2:6)))},end:function(t){return t.wyEnd||(t.wyEnd=e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t)+(e.dw.val(t)>1?8-e.dw.val(t):0)))},next:function(t,n){var r=e.dw.next(e.wy.start(t),5),a=e.date.nextRollover(r,n,e.wy,e.Y);1!==e.wy.val(a)&&(a=e.dw.next(a,2));var o=e.wy.extent(a)[1],u=e.wy.start(a);return n=n>o?1:n,e.date.next(e.Y.val(u),e.M.val(u),e.D.val(u)+7*(n-1))},prev:function(t,n){var r=e.dw.next(e.wy.start(t),5),a=e.date.prevRollover(r,n,e.wy,e.Y);1!==e.wy.val(a)&&(a=e.dw.next(a,2));var o=e.wy.extent(a)[1],u=e.wy.end(a);return n=n>o?o:n,e.wy.end(e.date.next(e.Y.val(u),e.M.val(u),e.D.val(u)+7*(n-1)))}},e.year=e.Y={name:"year",val:function(t){return t.Y||(t.Y=e.date.getYear.call(t))},extent:function(){return[e.option.minYear,e.option.maxYear]},start:function(t){return t.YStart||(t.YStart=e.date.next(e.Y.val(t)))},end:function(t){return t.YEnd||(t.YEnd=e.date.prev(e.Y.val(t)))},next:function(t,n){return n>e.Y.val(t)&&e.Y.extent()[1]>=n?e.date.next(n):void 0},prev:function(t,n){return e.Y.val(t)>n&&n>=e.Y.extent()[0]?e.date.prev(n):void 0}},e.constraintOrder=["Y","year","dy","dayOfYear","wy","weekOfYear","M","month","wm","weekOfMonth","dwc","dayOfWeekCount","D","day","dw","dayOfWeek","t","time","h","hour","m","minute","s","second"],e.option={maxYear:2025,minYear:2005},e.dir={forward:0,reverse:1},e.compile=function(t){for(var n,r=[],a=0,o=0,u=e.constraintOrder.length;u>o;o++){var i=e.constraintOrder[o],v=t[i];v&&(r.push({constraint:e[i],vals:v}),a++)}return n=r[a-1].constraint,{start:function(t,n){for(var o=n,u=e.array[t],i=!1;!i&&o;){i=!0;for(var v=0;a>v;v++){var d=r[v].constraint,l=d.val(o),f=r[v].vals,c=d.extent(o),s=u(l,f,c);if(l!==s){o=d[t](o,s),i=!1;break}}}return o},end:function(t,n){var o,u=e.array[t+"Invalid"],i=a-1;do{var v=r[i].constraint,d=v.val(n),l=r[i].vals,f=v.extent(n),c=u(d,l,f);c===d?o=n:c&&(o=v[t](n,c))}while(--i>=0&&void 0===o);return o},tick:function(t,r){return new Date("next"===t?n.end(r).getTime()+e.SEC:n.start(r).getTime()-e.SEC)}}},e.schedule=function(t,n){function r(e,t){return t?new Date(e.getTime()-1e3*n):new Date(e.getTime()+1e3*n)}function a(e,t,n){return n?e.getTime()<t.getTime():e.getTime()>t.getTime()}function o(e,t,n){n.setMilliseconds(0);var r=i(e,t,n);return r?n.getTime()===r.getTime():!1}function u(e,t,n,a){var o;if(1===n)o=i(d,f,e,t,a);else for(o=[];n--;){var u=i(d,f,e,t,a);if(!u)break;o.push(u),e=r(u,a)}return o}function i(e,t,n,r,o){for(var u,i=n||new Date;i;){var d;if(e.length)for(var l=0,f=e.length;f>l;l++)d=e[l].getValid(i,o),!d||u&&!a(u,d,o)||(u=d);else u=i;if(i=null,u&&t.length&&(d=v(t,[],u,o),d.getTime()!==u.getTime()&&(i=d,u=void 0)),u&&r&&a(u,r,o)){u=void 0;break}}return u}function v(e,t,n,r){for(var u=n||new Date;u&&o(e,t,u);){for(var v,d,l=0,f=e.length;f>l;l++){var c=e[l].getInvalid(u,r);!c||d&&!a(c,d,r)||(d=c)}t.length&&(v=i(t,[],u,null,r)),u=d||v?new Date(d&&v?Math.min(d.getTime(),v.getTime()):v||d):void 0}return u}n=void 0===n?e.option.resolution:n;for(var d=[],l=t&&t.schedules?t.schedules.length:0,f=[],c=t&&t.exceptions?t.exceptions.length:0,s=0;l>s;s++)d.push(e.compile(t.schedules[s]));for(var h=0;c>h;h++)f.push(e.compile(t.exceptions[h]));return{isValid:function(e){return o(d,f,e)},next:function(e,t,n){return u(e,t,n||1,!1)},nextRange:function(e,t){var n=i(d,f,e,t,!1),r=v(d,f,n,!1);return[n,r]},prev:function(e,t,n){return u(e,t,n||1,!0)},prevRange:function(e){var t=i(d,f,e,null,!0),n=v(d,f,t,!0);return[t,n]}}},e.instancesOf=function(t){function n(e,t,n,a,o){var u=n?new Date(n):new Date,i=r(e,t,u,a,o);return 0===i.length?void 0:1===t?i[0]:i}function r(e,t,n,r,l){var f,c=d(e),s=v(e),h=[],p=[];for(i(e,h,n);t--;){for(;f=h[c(h)];){if(r&&s(f.getTime(),r.getTime())){f=null;break}var m=o(e,f);{if(!m){if(l){var x=a(e,h,f);i(e,h,x),p.push([new Date(f),new Date(x)])}else p.push(new Date(f)),u(e,h,f);break}i(e,h,m)}}if(!f)break}return p}function a(e,t,n){for(var r,a=v(e),o=0;f>o;o++)if(t[o].getTime()===n.getTime()){var u=l[o].end(e,n);(!r||a(u,r))&&(r=u)}for(var i=0;s>i;i++){var d=c[i].start(e,n);a(r,d)&&(r=d)}return new Date(r)}function o(e,t){var n,r=v(e);if(s)for(var a=0;s>a;a++)if(c[a].start(e,t).getTime()===t.getTime()){var o=c[a].end(e,t);n=!n||r(o,n)?o:n}return n}function u(e,t,n){for(var r=0;f>r;r++)t[r].getTime()===n.getTime()&&(t[r]=l[r].start(e,l[r].tick(e,n)))}function i(e,t,n){for(var r=v(e),a=0;f>a;a++)(!t[a]||r(n,t[a]))&&(t[a]=l[a].start(e,n))}function v(e){return"next"===e?function(e,t){return e>t}:function(e,t){return t>e}}function d(t){return"next"===t?e.array.minIndex:e.array.maxIndex}for(var l=[],f=t.schedules.length,c=[],s=t.exceptions?t.exceptions.length:0,h=0;f>h;h++)l.push(e.compile(t.schedules[h]));for(var p=0;s>p;p++)c.push(e.compile(t.exceptions[p]));return{isValid:function(e){return void 0!==this.next(1,e,e)},next:function(e,t,r){return n("next",e||1,t,r)},prev:function(e,t,r){return n("prev",e||1,t,r)},nextRange:function(e,t,r){return n("next",e||1,t,r,!0)},prevRange:function(e,t,r){return n("prev",e||1,t,r,!0)}}},e.date={},e.date.UTC=function(){e.date.build=function(e,t,n,r,a,o){return new Date(Date.UTC(e,t,n,r,a,o))},e.date.getYear=Date.prototype.getUTCFullYear,e.date.getMonth=Date.prototype.getUTCMonth,e.date.getDate=Date.prototype.getUTCDate,e.date.getDay=Date.prototype.getUTCDay,e.date.getHour=Date.prototype.getUTCHours,e.date.getMin=Date.prototype.getUTCMinutes,e.date.getSec=Date.prototype.getUTCSeconds},e.date.localTime=function(){e.date.build=function(e,t,n,r,a,o){return new Date(e,t,n,r,a,o)},e.date.getYear=Date.prototype.getFullYear,e.date.getMonth=Date.prototype.getMonth,e.date.getDate=Date.prototype.getDate,e.date.getDay=Date.prototype.getDay,e.date.getHour=Date.prototype.getHours,e.date.getMin=Date.prototype.getMinutes,e.date.getSec=Date.prototype.getSeconds},e.date.UTC(),e.date.nextRollover=function(e,t,n,r){return n.val(e)>=t?r.next(e,r.val(e)+1):r.start(e)},e.date.prevRollover=function(e,t,n,r){return t>=n.val(e)?r.start(r.prev(e,r.val(e)-1)):r.start(e)},e.SEC=1e3,e.MIN=60*e.SEC,e.HOUR=60*e.MIN,e.DAY=24*e.HOUR,e.WEEK=7*e.DAY,e.date.pad=function(e){return 10>e?"0"+e:e},e.date.mod=function(e,t,n){return e>t?n||0:(n||0)>e?t:e},e.date.next=function(t,n,r,a,o,u){return e.date.build(t,void 0!==n?n-1:0,void 0!==r?r:1,a||0,o||0,u||0)},e.date.prev=function(t,n,r,a,o,u){var i=arguments.length;return n=2>i?11:n-1,r=3>i?e.D.extent(e.date.next(t,n+1))[1]:r,a=4>i?23:a,o=5>i?59:o,u=6>i?59:u,e.date.build(t,n,r,a,o,u)},e.parse={},e.parse.cron=function(){function e(e,t){return isNaN(e)?l[e]||null:+e+(t||0)}function t(e){var t,n={};for(t in e)"dc"!==t&&"d"!==t&&(n[t]=e[t].slice(0));return n}function n(e,t,n,r,a){var o=n;for(e[t]||(e[t]=[]);r>=o;)0>e[t].indexOf(o)&&e[t].push(o),o+=a||1}function r(e,r,a,o){(r.d&&!r.dc||r.dc&&0>r.dc.indexOf(o))&&(e.push(t(r)),r=e[e.length-1]),n(r,"d",a,a),n(r,"dc",o,o)}function a(e,t,r){var a={},o={};1===r?(n(t,"D",1,3),n(t,"d",l.MON,l.FRI),n(a,"D",2,2),n(a,"d",l.TUE,l.FRI),n(o,"D",3,3),n(o,"d",l.TUE,l.FRI)):(n(t,"D",r-1,r+1),n(t,"d",l.MON,l.FRI),n(a,"D",r-1,r-1),n(a,"d",l.MON,l.THU),n(o,"D",r+1,r+1),n(o,"d",l.TUE,l.FRI)),e.exceptions.push(a),e.exceptions.push(o)}function o(t,r,a,o,u,i){var v=t.split("/"),d=+v[1],l=v[0];if("*"!==l&&"0"!==l){var f=l.split("-");o=e(f[0],i),u=e(f[1],i)}n(r,a,o,u,d)}function u(t,u,i,v,d,l){var f,c,s=u.schedules,h=s[s.length-1];"L"===t&&(t=v-1),null!==(f=e(t,l))?n(h,i,f,f):null!==(f=e(t.replace("W",""),l))?a(u,h,f):null!==(f=e(t.replace("L",""),l))?r(s,h,f,v-1):2===(c=t.split("#")).length?(f=e(c[0],l),r(s,h,f,e(c[1]))):o(t,h,i,v,d,l)}function i(e){return e.indexOf("#")>-1||e.indexOf("L")>0}function v(e,t){return i(e)&&!i(t)?1:0}function d(e){var t,n,r,a,o={schedules:[{}],exceptions:[]},i=e.split(" ");for(t in f)if(n=f[t],r=i[n[0]],r&&"*"!==r&&"?"!==r){a=r.split(",").sort(v);var d,l=a.length;for(d=0;l>d;d++)u(a[d],o,t,n[1],n[2],n[3])}return o}var l={JAN:1,FEB:2,MAR:3,APR:4,MAY:5,JUN:6,JUL:7,AUG:8,SEP:9,OCT:10,NOV:11,DEC:12,SUN:1,MON:2,TUE:3,WED:4,THU:5,FRI:6,SAT:7},f={s:[0,0,59],m:[1,0,59],h:[2,0,23],D:[3,1,31],M:[4,1,12],Y:[6,1970,2099],d:[5,1,7,1]};return{parse:function(e,t){var n=e.toUpperCase();return d(t?n:"0 "+n)}}},e.parse.recur=function(){function e(e,l,f){if(e=o?"a"+e:e,t||(c.push({}),t=c[0]),t[e]||(t[e]=[]),n=t[e],a){for(r=[],v=l;f>=v;v+=a)r.push(v);d={n:e,x:a,c:n.length,m:f}}r=u?[l]:i?[f]:r;var s=r.length;for(v=0;s>v;v+=1)0>n.indexOf(r[v])&&n.push(r[v]);r=a=o=u=i=0}var t,n,r,a,o,u,i,v,d,l=[],f=[],c=l;return{schedules:l,exceptions:f,on:function(){return r=arguments[0]instanceof Array?arguments[0]:arguments,this},every:function(e){return a=e,this},after:function(e){return o=!0,r=[e],this},first:function(){return u=1,this},last:function(){return i=1,this},at:function(){r=arguments;for(var t=0,n=r.length;n>t;t++){var a=r[t].split(":");3>a.length&&(r[t]+=":00")}return e("t"),this},afterTime:function(){r=arguments;for(var t=0,n=r.length;n>t;t++){var a=r[t].split(":");3>a.length&&(r[t]+=":00")}return e("ta"),this},beforeTime:function(){r=arguments;for(var t=0,n=r.length;n>t;t++){var a=r[t].split(":");3>a.length&&(r[t]+=":00")}return e("tb"),this},second:function(){return e("s",0,59),this},minute:function(){return e("m",0,59),this},hour:function(){return e("h",0,23),this},dayOfMonth:function(){return e("D",1,i?0:31),this},dayOfWeek:function(){return e("d",1,7),this},onWeekend:function(){return r=[1,7],this.dayOfWeek()},onWeekday:function(){return r=[2,3,4,5,6],this.dayOfWeek()},dayOfWeekCount:function(){return e("dc",1,i?0:5),this},dayOfYear:function(){return e("dy",1,i?0:366),this},weekOfMonth:function(){return e("wm",1,i?0:5),this},weekOfYear:function(){return e("wy",1,i?0:53),this},month:function(){return e("M",1,12),this},year:function(){return e("Y",1970,2450),this},startingOn:function(e){return this.between(e,d.m)},between:function(n,r){return t[d.n]=t[d.n].splice(0,d.c),a=d.x,e(d.n,n,r),this},and:function(){return t=c[c.push({})-1],this},except:function(){return c=f,t=null,this}}},e.parse.text=function(){function t(e,t,n,r){return{startPos:e,endPos:t,text:n,type:r}}function n(e){var n,r,a,o,u,i,v=e instanceof Array?e:[e],d=/\s+/;for(v.push(d),u=m;!n||n.type===d;){i=-1,r=x.substring(u),n=t(u,u,x.split(d)[0]);var l,f=v.length;for(l=0;f>l;l++)o=v[l],a=o.exec(r),a&&0===a.index&&a[0].length>i&&(i=a[0].length,n=t(u,u+i,r.substring(0,i),o));n.type===d&&(u=n.endPos)}return n}function r(e){var t=n(e);return m=t.endPos,t}function a(e){for(var t=+c(e),n=l(y.through)?+c(e):t,r=[],a=t;n>=a;a++)r.push(a);return r}function o(e){for(var t=a(e);l(y.and);)t=t.concat(a(e));return t}function u(e){var t,n,r,a;l(y.weekend)?e.on(g.sun,g.sat).dayOfWeek():l(y.weekday)?e.on(g.mon,g.tue,g.wed,g.thu,g.fri).dayOfWeek():(t=c(y.rank),e.every(t),n=d(e),l(y.start)?(t=c(y.rank),e.startingOn(t),f(n.type)):l(y.between)&&(r=c(y.rank),l(y.and)&&(a=c(y.rank),e.between(r,a))))}function i(e){l(y.first)?e.first():l(y.last)?e.last():e.on(o(y.rank)),d(e)}function v(e){m=0,x=e,h=-1;for(var t=p();x.length>m&&0>h;){var n=f([y.every,y.after,y.onthe,y.on,y.of,y["in"],y.at,y.and,y.except,y.also]);switch(n.type){case y.every:u(t);break;case y.after:t.after(c(y.rank)),d(t);break;case y.onthe:i(t);break;case y.on:t.on(o(y.dayName)).dayOfWeek();break;case y.of:t.on(o(y.monthName)).month();break;case y["in"]:t.on(o(y.yearIndex)).year();break;case y.at:for(t.at(c(y.time));l(y.and);)t.at(c(y.time));break;case y.also:t.and();break;case y.except:t.except();break;default:h=m}}return{schedules:t.schedules,exceptions:t.exceptions,error:h}}function d(e){var t=f([y.second,y.minute,y.hour,y.dayOfYear,y.dayOfWeek,y.dayInstance,y.day,y.month,y.year,y.weekOfMonth,y.weekOfYear]);switch(t.type){case y.second:e.second();break;case y.minute:e.minute();break;case y.hour:e.hour();break;case y.dayOfYear:e.dayOfYear();break;case y.dayOfWeek:e.dayOfWeek();break;case y.dayInstance:e.dayOfWeekCount();break;case y.day:e.dayOfMonth();break;case y.weekOfMonth:e.weekOfMonth();break;case y.weekOfYear:e.weekOfYear();break;case y.month:e.month();break;case y.year:e.year();break;default:h=m}return t}function l(e){var t=n(e).type===e;return t&&r(e),t}function f(e){var t=r(e);return t.type?t.text=s(t.text,e):h=m,t}function c(e){return f(e).text}function s(e,t){var n=e;switch(t){case y.time:var r=e.split(/(:|am|pm)/),a="pm"===r[3]?parseInt(r[0],10)+12:r[0],o=r[2].trim();n=(1===a.length?"0":"")+a+":"+o;break;case y.rank:n=parseInt(/^\d+/.exec(e)[0],10);break;case y.monthName:case y.dayName:n=g[e.substring(0,3)]}return n}var h,p=e.parse.recur,m=0,x="",y={eof:/^$/,rank:/^((\d\d\d\d)|([2-5]?1(st)?|[2-5]?2(nd)?|[2-5]?3(rd)?|(0|[1-5]?[4-9]|[1-5]0|1[1-3])(th)?))\b/,time:/^((([0]?[1-9]|1[0-2]):[0-5]\d(\s)?(am|pm))|(([0]?\d|1\d|2[0-3]):[0-5]\d))\b/,dayName:/^((sun|mon|tue(s)?|wed(nes)?|thu(r(s)?)?|fri|sat(ur)?)(day)?)\b/,monthName:/^(jan(uary)?|feb(ruary)?|ma((r(ch)?)?|y)|apr(il)?|ju(ly|ne)|aug(ust)?|oct(ober)?|(sept|nov|dec)(ember)?)\b/,yearIndex:/^(\d\d\d\d)\b/,every:/^every\b/,after:/^after\b/,second:/^(s|sec(ond)?(s)?)\b/,minute:/^(m|min(ute)?(s)?)\b/,hour:/^(h|hour(s)?)\b/,day:/^(day(s)?( of the month)?)\b/,dayInstance:/^day instance\b/,dayOfWeek:/^day(s)? of the week\b/,dayOfYear:/^day(s)? of the year\b/,weekOfYear:/^week(s)?( of the year)?\b/,weekOfMonth:/^week(s)? of the month\b/,weekday:/^weekday\b/,weekend:/^weekend\b/,month:/^month(s)?\b/,year:/^year(s)?\b/,between:/^between (the)?\b/,start:/^(start(ing)? (at|on( the)?)?)\b/,at:/^(at|@)\b/,and:/^(,|and\b)/,except:/^(except\b)/,also:/(also)\b/,first:/^(first)\b/,last:/^last\b/,"in":/^in\b/,of:/^of\b/,onthe:/^on the\b/,on:/^on\b/,through:/(-|^(to|through)\b)/},g={jan:1,feb:2,mar:3,apr:4,may:5,jun:6,jul:7,aug:8,sep:9,oct:10,nov:11,dec:12,sun:1,mon:2,tue:3,wed:4,thu:5,fri:6,sat:7,"1st":1,fir:1,"2nd":2,sec:2,"3rd":3,thi:3,"4th":4,"for":4};return{parse:function(e){return v(e.toLowerCase())}}},e.range={},e.range.isValid=function(e,t,n,r){return t.indexOf(e)>-1||r&&e===n&&t.indexOf(0)>-1},e.range.next=function(e,t,n){for(var r,a=null,o=t[0],u=t.length;u--;){if(r=t[u],r===e)return e;o=o>r?r:o,a=r>e&&(!a||a>r)?r:a}return a||(void 0===n?o:o+n)},e.range.nextInvalid=function(t,n,r,a,o){var u=r[0],i=r[1];if(e.range.isValid(t,n,i,o)){var v=t;do t=e.date.mod(t+1,i,u);while(t!==v&&e.range.isValid(t,n,i,o));return t===v?void 0:t>v?t:t+a}return!1},e.range.prev=function(e,t,n){for(var r,a=null,o=t.length,u=t[o-1];o--;){if(r=t[o],r===e)return e;u=r>u?r:u,a=e>r&&(!a||r>a)?r:a}return null!==a?a:void 0===n?u:u-n},e.range.prevInvalid=function(t,n,r,a,o){var u=r[0],i=r[1];if(e.range.isValid(t,n,i,o)){var v=t;do t=e.date.mod(t-1,i,u);while(t!==v&&e.range.isValid(t,n,i,o));return t===v?void 0:v>t?t:t-a}return!1},e}();